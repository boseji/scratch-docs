name: Send repository dispatch event

on:
  workflow_dispatch:
  push:
    branches:
      - main

# Article: How to trigger a GitHub action workflow in another repository
# https://dev.to/ngnijland/how-to-trigger-a-github-action-workflow-in-another-repository-k3k
# Create a repository dispatch event from the Source Repository
# https://docs.github.com/en/rest/repos/repos?apiVersion=2022-11-28#create-a-repository-dispatch-event
# Repository Dispatch to `repository_dispatch` on the Target Repository
# https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#repository_dispatch
# Need to Get and Renew a Personal Access Token (Classic) with all Repo permissions.
# Old: ${{ secrets.REPOSITORY_ACCESS_TOKEN }}
# Updating to Fine Grained Access Token - 2025-08-17
# Refer to Docs: https://docs.github.com/en/rest/repos/repos?apiVersion=2022-11-28#create-a-repository-dispatch-event
# Note:
# The fine-grained token must have the following permission set:
#
# - "Contents" repository permissions (write)
#
# This is equal to : Repository permissions
# - Read and Write access to code
# - Read access to metadata
#
# Update the Token every 90 days.

jobs:
  trigger-event:
    runs-on: ubuntu-latest
    steps:
      - name: Fire event
        run: |
          curl -L \
            -X POST \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer ${{ secrets.REPOSITORY_ACCESS_TOKEN }}" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            https://api.github.com/repos/boseji/-1/dispatches \
            -d '{"event_type":"dispatch-event","client_payload": {"message": "scratch-docs trigger repository!"}}'
